<Page xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
      xmlns:controls="using:MiBandApp.Controls" 
      xmlns:core="using:Microsoft.Xaml.Interactions.Core" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:interactivity="using:Microsoft.Xaml.Interactivity" 
      xmlns:local="using:MiBandApp" 
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:micro="using:Caliburn.Micro" 
      xmlns:tabs="using:MiBandApp.Views.Tabs" 
      xmlns:viewModels="using:MiBandApp.ViewModels" 
      x:Class="MiBandApp.Views.MainPage">
    <Page.Style>
        <StaticResource ResourceKey="DefaultPageStyle" />
    </Page.Style>
    <Page.BottomAppBar>
        <CommandBar ClosedDisplayMode="Compact">
            <AppBarButton x:Uid="MainPageRefreshButton" x:Name="RefreshAll" Icon="Sync" Label="refresh">
                <AppBarButton.IsEnabled>
                    <Binding Path="IsRefreshing" ConverterParameter="False">
                        <Binding.Converter>
                            <StaticResource ResourceKey="BoolToBool" />
                        </Binding.Converter>
                    </Binding>
                </AppBarButton.IsEnabled>
            </AppBarButton>
            <AppBarButton x:Uid="MainPageAlarmsButton" x:Name="OpenAlarms" Label="alarms">
                <AppBarButton.IsEnabled>
                    <Binding Path="IsBinded" />
                </AppBarButton.IsEnabled>
                <AppBarButton.Icon>
                    <BitmapIcon UriSource="/Resources/Images/appbar.clock.png" />
                </AppBarButton.Icon>
            </AppBarButton>
            <AppBarButton x:Uid="MainPageHistoryButton" x:Name="OpenHistory" Label="history">
                <AppBarButton.Icon>
                    <BitmapIcon UriSource="/Resources/Images/appbar.graph.line.png" />
                </AppBarButton.Icon>
            </AppBarButton>
            <AppBarButton x:Uid="MainPageDeviceButton" x:Name="ManageDevice" Label="device">
                <AppBarButton.IsEnabled>
                    <Binding Path="IsBinded" />
                </AppBarButton.IsEnabled>
            </AppBarButton>
            <AppBarButton x:Uid="MainPageProfileButton" x:Name="OpenUserInfo" Label="profile" />
            <AppBarButton x:Uid="MainPageSettingsButton" x:Name="OpenSettingsPage" Label="settings" />
            <AppBarButton x:Uid="MainPageAboutButton" x:Name="OpenAboutPage" Label="about" />
        </CommandBar>
    </Page.BottomAppBar>
    <Page.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Resources/SpecificStyles.xaml" />            
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Page.Resources>


    <StackPanel>
        <Grid VerticalAlignment="Stretch">
            <!--Grid.Margin>
                <StaticResource ResourceKey="RootContainerThickness" />
            </Grid.Margin-->
            <Grid.Background>
                <StaticResource ResourceKey="AppBackgroundBrush" />
            </Grid.Background>
            <Grid.RowDefinitions>  
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />       
            </Grid.RowDefinitions>
            
            <StackPanel>
                    <Grid Row="0">
                        <StackPanel>
                        <TextBlock VerticalAlignment="Top">
                            <TextBlock.Style>
                                <StaticResource ResourceKey="AppTitleStyle" />
                            </TextBlock.Style>
                        </TextBlock>
                        <StackPanel HorizontalAlignment="Right" VerticalAlignment="Top" Orientation="Horizontal">
                                    <Grid>
                                        
                                        <controls:Band Height="15" Margin="0,5,0,0" VerticalAlignment="Top">
                                            <!--controls:Animation>
                                                <Binding Path="BandAnimationType" />
                                            </controls:Animation-->
                                            <!--controls:DotsVisibility>
                                                <Binding Path="ShowConnectivityControlDots" 
                                                         Converter="{StaticResource BoolToVis}">                                                  
                                                </Binding>
                                            </controls:DotsVisibility-->
                                            <controls:Band.Foreground>
                                                <Binding Path="DevicePageHasWarning" 
                                                         ConverterParameter="DeviceWarningToColor"
                                                         Converter="{StaticResource CustomConverter}">                                                   
                                                </Binding>
                                             </controls:Band.Foreground>
                                        <!--controls:Value>
                                                <Binding Path="BatteryValue" />
                                            </controls:Value-->
                                        </controls:Band>
                                        
                                        <TextBlock MinWidth="20" 
                                                   Margin="5,0,0,0" 
                                                   HorizontalAlignment="Center" 
                                                   VerticalAlignment="Top">
                                    <TextBlock.Style>
                                        <StaticResource ResourceKey="AppTitleStyle" />
                                    </TextBlock.Style>
                                    <TextBlock.Text>
                                        <Binding Path="BatteryPercentString" />
                                    </TextBlock.Text>
                                </TextBlock>
                                    
                                    </Grid>
                                </StackPanel>
                            </StackPanel>
                    </Grid>
                
                    <ScrollViewer Grid.Row="1" IsZoomInertiaEnabled="True" 
                                  MaxZoomFactor="1" VerticalScrollBarVisibility="Hidden"
                                  VerticalSnapPointsType="Optional" ZoomMode="Disabled">
                      <ScrollViewer.Visibility>
                            <Binding Path="MessagesViewModel.IsMessageDisplayed" 
                                               ConverterParameter="False"
                                               Converter="{StaticResource BoolToVis}">                               
                            </Binding>
                        </ScrollViewer.Visibility>
                       <ScrollViewer.Content>
                            <StackPanel>
                                <Grid>
                                    <Grid Margin="0,10,0,10">
                                        <Grid.ColumnDefinitions>
                                               
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                              
                                        </Grid.ColumnDefinitions>
                                            <StackPanel>
                                                <ListView x:Name="TabsIconsListView">
                                                    <!--ListView.ItemContainerStyle>
                                                        <StaticResource ResourceKey="ListViewItemSemiTransparentUnselectedStyle" />
                                                    </ListView.ItemContainerStyle-->
                                                        <ListView.SelectedIndex>
                                                        <Binding ElementName="WalkSleepPivot" Path="SelectedIndex" Mode="TwoWay" />
                                                    </ListView.SelectedIndex>
                                                        <ListView.ItemsPanel>
                                                        <ItemsPanelTemplate>                                                              
                                                                <StackPanel Orientation="Horizontal" />                                                              
                                                        </ItemsPanelTemplate>
                                                    </ListView.ItemsPanel>
                                                        <ListView.Resources>
                                                        <ResourceDictionary>
                                                            <Style x:Key="HeartBitmapIconStyle" TargetType="BitmapIcon">
                                                                <Style.Setters>                                                                       
                                                                    <Setter Property="Height" Value="50" />
                                                                    <Setter Property="Margin" Value="5 0 20 0" />
                                                                    <Setter Property="UriSource" Value="/Resources/Images/heart305.png" />                                                                       
                                                                </Style.Setters>
                                                            </Style>
                                                        </ResourceDictionary>
                                                    </ListView.Resources>
                                                        
                                                    <ListView.Items>                                                            
                                                            <ListViewItem>
                                                            <ListViewItem.Content>
                                                                <BitmapIcon Height="50" Margin="0,0,20,0"
                                                                    UriSource="/Resources/Images/footsteps.png" />
                                                                </ListViewItem.Content>
                                                            </ListViewItem>
                                                            <ListViewItem>
                                                            <ListViewItem.Content>
                                                                <BitmapIcon Height="50" Margin="0,0,20,0"
                                                                    UriSource="/Resources/Images/moon-sleep-512-000000.png" />
                                                                </ListViewItem.Content>
                                                            </ListViewItem>                                                       
                                                    </ListView.Items>
                                                </ListView>

                                                <!--Attach="[Event Tapped] = [Action OpenUserInfo()];" -->
                                        <ListViewItem Grid.Column="1" HorizontalAlignment="Right" 
                                            HorizontalContentAlignment="Right" 
                                                VerticalContentAlignment="Center" >
                                                <ListViewItem.Content>
                                                        <StackPanel HorizontalAlignment="Right" 
                                                                    Orientation="Horizontal">
                                                            <Grid>
                                                                    <BitmapIcon Height="40" 
                                                                                HorizontalAlignment="Right" 
                                                                        UriSource="/Resources/Images/business57.png">
                                                                        <!--BitmapIcon.Foreground>
                                                                            <ThemeResource ResourceKey="PhoneDisabledBrush" />
                                                                        </BitmapIcon.Foreground-->
                                                                            <BitmapIcon.Visibility>
                                                                            <Binding Path="UserInfo.IsMale" 
                                                                            Converter="{StaticResource BoolToVis}">                                                                                  
                                                                </Binding>
                                                            </BitmapIcon.Visibility>
                                                            </BitmapIcon>
                                                    
                                                    <BitmapIcon Height="40" HorizontalAlignment="Right" 
                                                                UriSource="/Resources/Images/business64.png">
                                                        <!--BitmapIcon.Foreground>
                                                        <ThemeResource ResourceKey="PhoneDisabledBrush" />
                                                        </BitmapIcon.Foreground-->
                                                <BitmapIcon.Visibility>
                                                        <Binding Path="UserInfo.IsMale" 
                                                                    ConverterParameter="False"
                                                            Converter="{StaticResource BoolToVis}">                                                                                    
                                                    </Binding>
                                                </BitmapIcon.Visibility>
                                            </BitmapIcon>
                                                                    
                                <TextBlock MaxWidth="150" Margin="5,0,0,0" 
                                            VerticalAlignment="Center"
                                        FontSize="20" TextWrapping="Wrap">
                                    <TextBlock.Style>
                                    <StaticResource ResourceKey="GroupHeaderTextBlockStyle" />
                                    </TextBlock.Style>
                                    <TextBlock.Text>
                                    <Binding Path="UserInfo.Name" />
                                    </TextBlock.Text>
                                    </TextBlock>
                                  </Grid>
                                  </StackPanel>
                                 </ListViewItem.Content>
                                </ListViewItem>
                                </StackPanel>
                              </Grid>
                                    
                              <Pivot x:Name="WalkSleepPivot">
                                   <Pivot.Foreground>
                                    <StaticResource ResourceKey="AppForegroundBrush" />
                                   </Pivot.Foreground>
                                        <!--Pivot.Style>
                                            <StaticResource ResourceKey="PivotWithoutStupidPaddingStyle" />
                                        </Pivot.Style-->
                                        <Pivot.HeaderTemplate>
                                            <DataTemplate />
                                        </Pivot.HeaderTemplate>
                                            
                                        <Pivot.Items>
                                            <!--ItemCollection-->
                                                <PivotItem x:Uid="MainPageWalkTab" Header="walk">
                                                    <PivotItem.Content>
                                                        <ContentControl x:Name="WalkTabViewModel" />
                                                    </PivotItem.Content>
                                                </PivotItem>
                                                <PivotItem x:Uid="MainPageSleepTab" Header="sleep">
                                                        <PivotItem.Content>
                                                        <ContentControl x:Name="SleepTabViewModel" 
                                                                        HorizontalContentAlignment="Stretch"
                                                                        VerticalContentAlignment="Stretch">
                                                            <ContentControl.MinHeight>
                                                                <Binding ElementName="WalkTabViewModel" 
                                                                            Path="ActualHeight" />
                                                            </ContentControl.MinHeight>
                                                        </ContentControl>
                                                    </PivotItem.Content>
                                                </PivotItem>
                                            <!--/ItemCollection-->
                                        </Pivot.Items>
                       </Pivot>
                                    
                       <Grid Margin="0,10,0,3">
                          <StackPanel>
                           <TextBlock>
                            <TextBlock.Foreground>
                              <Binding Path="SyncState" ConverterParameter="textblock"
                                       Converter="{StaticResource SyncStateConverter}">                               
                              </Binding>
                            </TextBlock.Foreground>
                            <TextBlock.Style>
                              <StaticResource ResourceKey="GrayTextBlockStyle" />
                            </TextBlock.Style>
                            <TextBlock.Text>
                              <Binding Path="SyncState" Converter="{StaticResource SyncStateConverter}">                              
                              </Binding>
                            </TextBlock.Text>
                           </TextBlock>

                       <!-- Attach="[Event Tapped] = [Action ShowSyncHelp()];" -->
                     <ListViewItem Height="20" HorizontalAlignment="Right" VerticalAlignment="Bottom" >
                    <ListViewItem.Visibility>
                               <Binding Path="SyncState" ConverterParameter="Failed"
                                        Converter="{StaticResource SyncStateConverter}">
                               </Binding>
                    </ListViewItem.Visibility>
                     <ListViewItem.Content>
                      <TextBlock FontWeight="ExtraLight" Foreground="Red">
                         <TextBlock.Style>
                          <StaticResource ResourceKey="GrayTextBlockStyle" />
                         </TextBlock.Style>
                        <TextBlock.Inlines>

                        <Underline>
                            <Underline.Inlines>
                             <Run x:Uid="MainPageSyncErrorWhatToDo" Text="what to do?" />
                            </Underline.Inlines>
                         </Underline>

                             </TextBlock.Inlines>
                            </TextBlock>
                           </ListViewItem.Content>
                         </ListViewItem>
                   </StackPanel>
                   </Grid>
                      <Grid>
                            <!--Grid.Background>
                                <ThemeResource ResourceKey="CommandBarBackgroundThemeBrush" />
                            </Grid.Background-->
                          
                            <StackPanel>                                              
                                        <ProgressBar Value="100">
                                            <ProgressBar.Foreground>
                                                <Binding Path="SyncState" 
                                                    Converter="{StaticResource SyncStateConverter}">                                                               
                                                </Binding>
                                            </ProgressBar.Foreground>
                                                <ProgressBar.IsIndeterminate>
                                                <Binding Path="SyncState" 
                                                            ConverterParameter="InProgress"
                                                            Converter="{StaticResource SyncStateConverter}">                                                                
                                                </Binding>
                                            </ProgressBar.IsIndeterminate>
                                        </ProgressBar>
                                    </StackPanel>
                            </Grid>
                            <ContentControl x:Name="ActivitiesListViewModel" 
                                            HorizontalAlignment="Stretch" 
                                            HorizontalContentAlignment="Stretch" />
                        </Grid>
                </StackPanel>
            </ScrollViewer.Content>
        </ScrollViewer>
                
        <Grid Row="1" VerticalAlignment="Center">
            <Grid.Children>                            
                    <ContentControl x:Name="MessagesViewModel" 
                                    HorizontalContentAlignment="Stretch" 
                                    VerticalContentAlignment="Stretch" />                          
            </Grid.Children>
        </Grid>
    </StackPanel>            
   </Grid>
 </StackPanel>

</Page>

